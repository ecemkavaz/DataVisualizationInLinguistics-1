#build:
#  docker:
#    web: Dockerfile
#run:
#  web: docker-compose up web

build:
  docker:
    - context: .
      dockerfile: Dockerfile
      target: rasa
    - context: .
      dockerfile: Dockerfile
      target: rasa-actions
    - context: .
      dockerfile: Dockerfile
      target: web
run:
  - type: web
    command: python manage.py makemigrations DataVisualization && python manage.py migrate && python manage.py runserver 0.0.0.0:$PORT
  - type: rasa
    command: bash -c "rm -rf .rasa/* && rasa train && rasa run -m models --enable-api --auth-token DataVisualizationInLinguisticsSecretToken --cors \"*\" -p $PORT"
  - type: rasa-actions
    command: bash -c "rasa run actions"
addons:
  - plan: heroku-postgresql
    as: DATABASE






#build:
#  docker:
#    web: Dockerfile
#  config:
#    rasa: docker-compose.yml
#
#run:
#  web:
#    command:
#      - ./start.sh
#

